const mongoose = require("mongoose"); const bcrypt = require("bcrypt"); const uri = process.env.MONGODB_URI || "mongodb://localhost:27017/user-service"; async function resetUserPassword() { try { await mongoose.connect(uri); console.log("已连接到数据库"); const User = mongoose.model("User", new mongoose.Schema({ email: String, password: String, isLocked: Boolean, loginAttempts: Number, lockUntil: Date })); const saltRounds = 10; const hashedPassword = await bcrypt.hash("Password123!", saltRounds); const result = await User.updateOne({ email: "wyk9@outlook.com" }, { $set: { password: hashedPassword, isLocked: false, loginAttempts: 0 }, $unset: { lockUntil: 1 } }); console.log("更新结果:", result.modifiedCount > 0 ? "密码重置成功" : "未找到用户或密码未更改"); mongoose.connection.close(); } catch (error) { console.error("错误:", error); } } resetUserPassword();
